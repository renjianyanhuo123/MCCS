<UserControl x:Class="MCCS.UserControl.Pagination.PaginationUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:MCCS.UserControl.Pagination"
             xmlns:converters="clr-namespace:MCCS.UserControl.Converters"
             xmlns:localBehavior="clr-namespace:MCCS.UserControl.Behaviors" d:DataContext="{d:DesignInstance Type=local:PaginationViewModel}"
             mc:Ignorable="d"
             x:Name="PaginationControl"
             d:DesignHeight="60" d:DesignWidth="1000">
    <!--<i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding WindowLoadedCommand}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>-->
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/MCCS.UserControl;component/Styles/CustomComboBoxStyle.xaml"/>
                <ResourceDictionary Source="/MCCS.UserControl;component/Styles/CustomTextBox.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <!-- 定义转换器 -->
            <converters:PropertyToResourceConverter x:Key="PropertyToResourceConverter" />
            <converters:ComboBoxItemToIntConverter x:Key="ComboBoxItemToIntConverter" />
            <!-- Base Border Style -->
            <Style x:Key="BasePageBorderStyle" TargetType="Border">
                <Setter Property="Height" Value="28" />
                <Setter Property="Width" Value="28" />
                <Setter Property="Background" Value="#FFFFFF"/>
                <Setter Property="BorderBrush" Value="#D9D9D9"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="5"/>
                <Setter Property="Margin" Value="0 0 8 0"/>
                <Setter Property="Cursor" Value="Hand"/>
            </Style>
            <!-- Base TextBlock Style -->
            <Style x:Key="BaseTextBlockStyle" TargetType="TextBlock">
                <Setter Property="HorizontalAlignment" Value="Center" />
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="FontFamily" Value="Arial"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Foreground" Value="#666666"/>
            </Style>
            <!-- Border Style -->
            <Style x:Key="PageBorderStyle" TargetType="Border" BasedOn="{StaticResource BasePageBorderStyle}">
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="BorderBrush" Value="#2DB7F5" />
                    </Trigger>
                </Style.Triggers>
            </Style>
            <!-- TextBlock Style -->
            <Style x:Key="PageTextBlockStyle" TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource FindAncestor, AncestorType=Border}}" Value="True">
                        <Setter Property="Foreground" Value="#2DB7F5" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <!-- Selected TextBlock Style -->
            <Style x:Key="SelectedPageTextBlockStyle" TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
                <Setter Property="Foreground" Value="#FFFFFF"/>
            </Style>
            <!-- Selected Border Style -->
            <Style x:Key="SelectedBorderStyle" TargetType="Border" BasedOn="{StaticResource BasePageBorderStyle}">
                <Setter Property="Background" Value="#2DB7F5"/>
                <Setter Property="BorderThickness" Value="0"/>
            </Style>
            <!-- Normal TextBox Style -->
            <Style x:Key="PageNormalTextStyle" TargetType="TextBlock">
                <Setter Property="FontFamily" Value="Arial"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="Foreground" Value="#666666"/>
                <Setter Property="HorizontalAlignment" Value="Center" />
                <Setter Property="VerticalAlignment" Value="Center" />
            </Style>
            <!-- Template Selector -->
            <local:PaginationTemplateSelector x:Key="PaginationTemplateSelector">
                <!-- Image Template -->
                <local:PaginationTemplateSelector.ImageDataTemplate>
                    <DataTemplate>
                        <Border Width="16" Height="Auto" Margin="0 0 8 0">
                            <Image Source="/MCCS.UserControl;component/Assert/omitPoint_16.png" />
                        </Border>
                    </DataTemplate>
                </local:PaginationTemplateSelector.ImageDataTemplate>
                <!-- TextBlock Template -->
                <local:PaginationTemplateSelector.TextBlockTemplate>
                    <DataTemplate>
                        <Border>
                            <!-- 点击事件行为 -->
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseLeftButtonUp">
                                    <i:InvokeCommandAction Command="{Binding DataContext.JumpToPageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                           CommandParameter="{Binding Num}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Border.Style>
                                <MultiBinding Converter="{StaticResource PropertyToResourceConverter}" ConverterParameter="PageBorder">
                                    <Binding Path="IsSelected"/>
                                    <Binding ElementName="PaginationControl"/>
                                </MultiBinding>
                            </Border.Style>
                            <TextBlock Text="{Binding Num}">
                                <TextBlock.Style>
                                    <MultiBinding Converter="{StaticResource PropertyToResourceConverter}"
                                                  ConverterParameter="PageTextBlock">
                                        <Binding Path="IsSelected"/>
                                        <Binding ElementName="PaginationControl"/>
                                    </MultiBinding>
                                </TextBlock.Style>
                            </TextBlock>
                        </Border>
                    </DataTemplate>
                </local:PaginationTemplateSelector.TextBlockTemplate>
            </local:PaginationTemplateSelector>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid Background="Transparent">
        <StackPanel 
            Orientation="Horizontal" 
            VerticalAlignment="Center"
            Background="Transparent"
            Width="{Binding ActualWidth, ElementName=root}"
            Height="{Binding ActualHeight, ElementName=root}">
            <!-- Total Page Text Area -->
            <StackPanel x:Name="TotalStackPanel"
                        Orientation="Horizontal" 
                        Margin="8 0 8 0">
                <TextBlock Style="{StaticResource PageNormalTextStyle}" Text="共" />
                <TextBlock 
                    x:Name="TotalText"
                    Style="{StaticResource PageNormalTextStyle}" 
                    Margin="5 0 5 0" 
                    Text="{Binding Total}"
                    FontWeight="Bold" />
                <TextBlock Style="{StaticResource PageNormalTextStyle}" Text="条" />
            </StackPanel>
            <!-- Last Page Btn -->
            <Border Style="{StaticResource PageBorderStyle}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseLeftButtonUp">
                        <i:InvokeCommandAction Command="{Binding PreviousPageCommand}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <Image Width="16" Height="16" Source="/MCCS.UserControl;component/Assert/left_32.png" />
            </Border>
            <!-- Page Items -->
            <ItemsControl ItemsSource="{Binding SelectorUnits}" 
                          ItemTemplateSelector="{StaticResource PaginationTemplateSelector}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
            <!-- Next Page Btn -->
            <Border Style="{StaticResource PageBorderStyle}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseLeftButtonUp">
                        <i:InvokeCommandAction Command="{Binding NextPageCommand}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <Image Width="16" Height="16" Source="/MCCS.UserControl;component/Assert/right_32.png" />
            </Border>
            <ComboBox 
                x:Name="SelectPageSize"
                Tag="条/页" 
                SelectedItem="{Binding PageSize, Mode=TwoWay, Converter={StaticResource ComboBoxItemToIntConverter},ConverterParameter=条/页}"
                Style="{StaticResource CustomComboBoxWithItemStyle}"
                Margin="5 0 15 0">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectionChanged">
                        <i:InvokeCommandAction Command="{Binding SelectedChangedCommand}" CommandParameter="{Binding ElementName=SelectPageSize, Path=SelectedItem}"   />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <ComboBoxItem>10条/页</ComboBoxItem>
                <ComboBoxItem>20条/页</ComboBoxItem>
                <ComboBoxItem>30条/页</ComboBoxItem>
                <ComboBoxItem>40条/页</ComboBoxItem>
                <ComboBoxItem>50条/页</ComboBoxItem>
            </ComboBox>
            <StackPanel Orientation="Horizontal">
                <TextBlock 
                    Width="Auto" 
                    Height="Auto" 
                    Margin="0 0 8 0"
                    Style="{StaticResource PageNormalTextStyle}" 
                    Text="跳转" />
                <TextBox 
                    Width="50" 
                    Height="30"
                    VerticalContentAlignment="Center"
                    Margin="0 0 8 0" 
                    Text="{Binding TargetPage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <i:Interaction.Behaviors>
                        <localBehavior:EnterKeyCommandBehavior Command="{Binding JumpToPageCommand}" CommandParameter="{Binding TargetPage}"/>
                    </i:Interaction.Behaviors>
                </TextBox>
                <TextBlock Text="页"
                           Width="Auto" 
                           Height="Auto" 
                           Margin="0 0 8 0"
                           Style="{StaticResource PageNormalTextStyle}" />
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
