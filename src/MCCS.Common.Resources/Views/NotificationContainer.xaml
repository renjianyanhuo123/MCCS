<UserControl x:Class="MCCS.Common.Resources.Views.NotificationContainer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels="clr-namespace:MCCS.Common.Resources.ViewModels"
             xmlns:views="clr-namespace:MCCS.Common.Resources.Views"
             mvvm:ViewModelLocator.AutoWireViewModel="True"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:MCCS.Common.Resources.Resources.Converters"
             xmlns:mvvm="http://prismlibrary.com/"
             xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
             d:DataContext="{d:DesignInstance Type=viewModels:NotificationViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:NotificationTypeToBackgroundColor x:Key="NotificationTypeToBackgroundColor" />
        <converters:NotificationTypeToBorderColor x:Key="NotificationTypeToBorderColor" />
        <converters:NotificationTypeToIconColor x:Key="NotificationTypeToIconColor" />
        <converters:NotificationTypeToIconText x:Key="NotificationTypeToIconText" />
    </UserControl.Resources>
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </UserControl.Triggers>
    <ItemsControl ItemsSource="{Binding Notifications}">
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <Border x:Name="MainBorder" BorderThickness="1" CornerRadius="6"
                        Background="{Binding Type, Converter={StaticResource NotificationTypeToBackgroundColor}}"
                        BorderBrush="{Binding Type, Converter={StaticResource NotificationTypeToBorderColor}}"
                        Margin="0,0,0,8" Padding="12" Width="300">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Direction="270" ShadowDepth="2" BlurRadius="6" Opacity="0.2"/>
                    </Border.Effect>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 图标 -->
                        <Ellipse Grid.Column="0" Width="24" Height="24" Fill="{Binding Type, Converter={StaticResource NotificationTypeToIconColor}}" />
                        <materialDesign:PackIcon Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                 Foreground="White" FontWeight="Bold" FontSize="12" Kind="{Binding Type, Converter={StaticResource NotificationTypeToIconText}}" />
                        <!-- 内容 -->
                        <StackPanel Grid.Column="1" Margin="15,0,0,0">
                            <TextBlock Text="{Binding Title}" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding Message}" FontSize="12" TextWrapping="Wrap" Foreground="#666"/>
                        </StackPanel>

                        <!-- 关闭按钮 -->
                        <materialDesign:PackIcon Kind="Close" Grid.Column="2" Cursor="Hand" Width="20" Height="20"
                                                 Background="Transparent">
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="MouseLeftButtonDown">
                                    <mvvm:InvokeCommandAction Command="{Binding DataContext.CloseCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                              CommandParameter="{Binding}"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </materialDesign:PackIcon>

                    </Grid>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>
